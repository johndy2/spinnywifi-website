<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Super Spinny Brawl</title>
    <style>
        body { background: #0a0a0c; color: #00ffcc; text-align: center; font-family: 'Courier New', monospace; overflow: hidden; margin: 0; }
        canvas { background: #050505; border: 2px solid #00ffcc; display: none; margin: 10px auto; box-shadow: 0 0 30px #004433; }
        .hud { display: none; justify-content: center; align-items: center; gap: 50px; font-size: 35px; margin-top: 20px; text-shadow: 0 0 10px #00ffcc; }
        .timer { font-size: 50px; color: #fff; border: 2px solid #fff; padding: 5px 20px; min-width: 100px; }
        .p1 { color: #00d2ff; } .p2 { color: #ff0055; }
        .win-msg, #countdown, #pauseMenu { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 60px; background: rgba(0,0,0,0.95); padding: 40px; display: none; border: 2px solid #00ffcc; z-index: 100; color: #fff; text-align: center; }
        
        #menu { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); border: 2px solid #00ffcc; background: #050505; padding: 40px; box-shadow: 0 0 50px #004433; z-index: 20; }
        .btn { display: block; width: 280px; padding: 12px; margin: 10px auto; background: transparent; color: #00ffcc; border: 1px solid #00ffcc; font-family: 'Courier New', monospace; font-size: 18px; cursor: pointer; transition: 0.2s; }
        .btn:hover { background: #00ffcc; color: #000; }
        .diff-container { display: flex; gap: 5px; justify-content: center; margin-bottom: 20px; }
        .diff-btn { padding: 5px 10px; font-size: 12px; border: 1px solid #666; color: #666; cursor: pointer; background: none; }
        .diff-btn.active { border-color: #00ffcc; color: #00ffcc; }
        .pause-title { font-size: 40px; color: #00ffcc; margin-bottom: 20px; }
    </style>
</head>
<body>
    <div id="menu">
        <h1>SUPER SPINNY BRAWL</h1>
        <p>AI DIFFICULTY</p>
        <div class="diff-container">
            <button class="diff-btn" onclick="setDiff(0.5, 60, this)">EASY</button>
            <button class="diff-btn active" onclick="setDiff(1, 35, this)">MED</button>
            <button class="diff-btn" onclick="setDiff(1.6, 15, this)">HARD</button>
        </div>
        <button class="btn" onclick="preStart(true)">1 PLAYER (VS BOT)</button>
        <button class="btn" onclick="preStart(false)">2 PLAYERS (LOCAL)</button>
    </div>

    <!-- Pause Menu -->
    <div id="pauseMenu">
        <div class="pause-title">Safe Menu</div>
        <button class="btn" onclick="togglePause()">RESUME</button>
        <button class="btn" onclick="location.reload()">MAIN MENU</button>
    </div>

    <div id="countdown"></div>
    <div id="winMsg" class="win-msg"></div>
    <div id="hud" class="hud">
        <div class="p1">C: <span id="p1%">0</span>%</div>
        <div id="timer" class="timer">60</div>
        <div class="p2"><span id="p2Label">BOT</span>: <span id="p2%">0</span>%</div>
    </div>
    <canvas id="game" width="900" height="500"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
let gameRunning = false;
let isPaused = false;
let botSpeedMult = 1;
let botAggression = 35;
let timeLeft = 60;
let particles = [];
let p1, p2;
let timerInterval;

function setDiff(speed, aggro, btn) {
    botSpeedMult = speed;
    botAggression = aggro;
    document.querySelectorAll('.diff-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
}

function preStart(vsBot) {
    document.getElementById("menu").style.display = "none";
    document.getElementById("game").style.display = "block";
    document.getElementById("hud").style.display = "flex";
    
    p1 = new Fighter(300, "#00d2ff", {up:'w', left:'a', right:'d', attack:' '}, "p1", "C:");
    p2 = new Fighter(600, "#ff0055", {up:'ArrowUp', left:'ArrowLeft', right:'ArrowRight', attack:'Enter'}, "p2", vsBot ? "BOT" : "D:", vsBot);
    document.getElementById("p2Label").innerText = vsBot ? "BOT" : "D:";

    let count = 3;
    const cdDiv = document.getElementById("countdown");
    cdDiv.style.display = "block";
    cdDiv.innerText = count;

    const cdInterval = setInterval(() => {
        count--;
        if (count > 0) cdDiv.innerText = count;
        else if (count === 0) cdDiv.innerText = "OVERWRITE!";
        else {
            clearInterval(cdInterval);
            cdDiv.style.display = "none";
            gameRunning = true;
            startTimer();
            loop();
        }
    }, 800);
}

function startTimer() {
    timerInterval = setInterval(() => {
        if (gameRunning && !isPaused) {
            timeLeft--;
            document.getElementById("timer").innerText = timeLeft;
            if (timeLeft <= 0) {
                gameRunning = false;
                const winnerText = p1.percent < p2.percent ? "DRIVE C: WINS" : (p2.isBot ? "BOT WINS" : "DRIVE D: WINS");
                endGame(winnerText);
                clearInterval(timerInterval);
            }
        }
    }, 1000);
}

function togglePause() {
    if (!gameRunning) return;
    isPaused = !isPaused;
    document.getElementById("pauseMenu").style.display = isPaused ? "block" : "none";
}

class Fighter {
    constructor(x, color, controls, name, label, isBot = false) {
        this.x = x; this.y = 200; this.w = 45; this.h = 60;
        this.color = color; this.controls = controls; this.name = name; this.label = label;
        this.vx = 0; this.vy = 0; this.percent = 0; this.isBot = isBot;
        this.jumpCount = 0; this.maxJumps = 2; this.dir = 1; this.canJump = true;
        this.attackCooldown = 0;
    }

    update(keys, opponent) {
        if (!gameRunning || isPaused) return;
        if (this.isBot) this.handleAI(opponent);
        else {
            if (keys[this.controls.left]) { this.vx = -5.5; this.dir = -1; }
            else if (keys[this.controls.right]) { this.vx = 5.5; this.dir = 1; }
            else { this.vx *= 0.88; }
            if (keys[this.controls.up]) {
                if (this.canJump && this.jumpCount < this.maxJumps) {
                    this.vy = -13; this.jumpCount++; this.canJump = false;
                }
            } else { this.canJump = true; }
            if (keys[this.controls.attack]) { this.performAttack(opponent); keys[this.controls.attack] = false; }
        }
        
        this.vy += 0.55; this.x += this.vx; this.y += this.vy;
        
        if (this.x + this.w > 200 && this.x < 700 && this.y + this.h > 400 && this.y < 420 && this.vy >= 0) {
            this.y = 400 - this.h; this.vy = 0; this.jumpCount = 0;
        }
        
        if (this.x < -150 || this.x > canvas.width + 150 || this.y < -150 || this.y > canvas.height + 150) {
            this.respawn();
        }
    }

    handleAI(target) {
        let speed = 4.5 * botSpeedMult;
        if (this.x < 220) { this.vx = speed; if(this.jumpCount < 2) { this.vy = -13; this.jumpCount++; } }
        else if (this.x > 630) { this.vx = -speed; if(this.jumpCount < 2) { this.vy = -13; this.jumpCount++; } }
        else {
            if (target.x < this.x - 30) { this.vx = -speed; this.dir = -1; }
            else if (target.x > this.x + 30) { this.vx = speed; this.dir = 1; }
            else { this.vx *= 0.8; }
        }
        this.attackCooldown--;
        if (Math.abs(target.x - this.x) < 70 && Math.abs(this.y - target.y) < 50 && this.attackCooldown <= 0) {
            this.performAttack(target);
            this.attackCooldown = botAggression;
        }
    }

    performAttack(opponent) {
        let hitX = this.x + (this.dir === 1 ? 40 : -40);
        if (hitX < opponent.x + opponent.w && hitX + 30 > opponent.x && Math.abs(this.y - opponent.y) < 60) {
            opponent.takeHit(this.dir);
        }
    }

    takeHit(direction) {
        this.percent += 12;
        let kb = 5 + (this.percent * 0.25);
        this.vx = direction * kb; this.vy = -kb * 0.4;
        document.getElementById(this.name + "%").innerText = this.percent;
    }

    respawn() {
        this.percent = 0; 
        this.x = 450; this.y = 100; this.vx = 0; this.vy = 0; 
        document.getElementById(this.name + "%").innerText = this.percent;
        for (let i = 0; i < 20; i++) {
            particles.push({x: 450, y: 100, vx: (Math.random()-0.5)*15, vy: (Math.random()-0.5)*15, alpha: 1, color: "#fff", text: "0"});
        }
    }

    draw() {
        ctx.save();
        ctx.translate(this.x, this.y);
        ctx.fillStyle = "#333"; ctx.fillRect(0, 0, this.w, this.h);
        ctx.strokeStyle = this.color; ctx.lineWidth = 2; ctx.strokeRect(0, 0, this.w, this.h);
        ctx.fillStyle = "white"; ctx.font = "bold 10px Courier"; ctx.fillText(this.label, 5, 15);
        ctx.restore();
    }
}

function endGame(winner) {
    const msg = document.getElementById("winMsg");
    msg.innerHTML = "TIME UP!<br><span style='font-size:30px'>" + winner + "</span>";
    msg.style.display = "block";
    setTimeout(() => location.reload(), 4000);
}

const keys = {};
window.onkeydown = (e) => { 
    if (e.key.toLowerCase() === 'b') togglePause();
    keys[e.key] = true; 
    if(["ArrowUp","ArrowDown"," ","Enter"].includes(e.key)) e.preventDefault(); 
};
window.onkeyup = (e) => keys[e.key] = false;

function loop() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.fillStyle = "#002211"; ctx.fillRect(200, 400, 500, 15);
    ctx.strokeStyle = "#00ffcc"; ctx.strokeRect(200, 400, 500, 15);
    
    p1.update(keys, p2); p2.update(keys, p1);
    p1.draw(); p2.draw();

    for (let i = particles.length - 1; i >= 0; i--) {
        let p = particles[i]; p.x += p.vx; p.y += p.vy; p.alpha -= 0.03;
        ctx.globalAlpha = p.alpha; ctx.fillStyle = p.color; ctx.fillText(p.text, p.x, p.y);
        if (p.alpha <= 0) particles.splice(i, 1);
    }
    ctx.globalAlpha = 1;
    if (gameRunning) requestAnimationFrame(loop);
}
</script>
</body>
</html>
